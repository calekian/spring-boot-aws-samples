name: 'CodeQL'
on: 'workflow_dispatch'
jobs:
  analyze:
    name: 'Build and analyze'
    permissions:
      actions: 'read'
      contents: 'read'
      security-events: 'write'
    timeout-minutes: 10
    runs-on: 'ubuntu-latest'
    steps:
      - name: 'Clone repository'
        uses: 'actions/checkout@v3'
        with:
          fetch-depth: 0
      - name: 'CodeQL initialize'
        uses: 'github/codeql-action@v2'
        with:
          languages: 'java'
          queries: 'security-and-quality'
      - name: 'Set up JDK 17'
        uses: 'actions/setup-java@v3'
        with:
          java-version: 17
          distribution: 'temurin'
      - name: 'Cache Maven packages'
        uses: 'actions/cache@v3'
        with:
          path: '~/.m2'
          key: "${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}"
          restore-keys: "${{ runner.os }}-m2"
      - name: 'Maven build'
        run: 'mvn --batch-mode clean verify'
      - name: 'CodeQL analyze'
        uses: 'github/codeql-action/analyze@v2'
        with:
          category: '/language:java'
